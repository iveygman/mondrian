<!DOCTYPE php>
<head>
    <style>
        svg {
            border: 4px solid black;
        }
    </style>
</head>
<script src='jquery-1.11.1.min.js'></script>
<script src='d3.min.js'></script>
<script>

var maxWidth = window.innerWidth * 0.9;
var maxHeight = window.innerHeight * 0.9;

/**
    Returns random integer between min and max
 */
function randomInt(min, max) {
    return Math.floor((Math.random() * max) + min);
}

/**
    Calculates the intersection point of two lines
    result contains x,y as well as two flags. both flags must be true for the lines to intersect
 */
function checkLineIntersection(line1, line2) {
    var line1point1 = line1.p1;
    var line1point2 = line1.p2;
    var line2point1 = line2.p1;
    var line2point2 = line2.p2;
    // if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite) and booleans for whether line segment 1 or line segment 2 contain the point
    var denominator, a, b, numerator1, numerator2, result = {
        x: null,
        y: null,
        onLine1: false,
        onLine2: false
    };
    denominator = ((line2point2.y - line2point1.y) * (line1point2.x - line1point1.x)) - ((line2point2.x - line2point1.x) * (line1point2.y - line1point1.y));
    if (denominator == 0) {
        return result;
    }
    a = line1point1.y - line2point1.y;
    b = line1point1.x - line2point1.x;
    numerator1 = ((line2point2.x - line2point1.x) * a) - ((line2point2.y - line2point1.y) * b);
    numerator2 = ((line1point2.x - line1point1.x) * a) - ((line1point2.y - line1point1.y) * b);
    a = numerator1 / denominator;
    b = numerator2 / denominator;

    // if we cast these lines infinitely in both directions, they intersect here:
    result.x = line1point1.x + (a * (line1point2.x - line1point1.x));
    result.y = line1point1.y + (a * (line1point2.y - line1point1.y));
/*
        // it is worth noting that this should be the same as:
        x = line2point1.x + (b * (line2point2.x - line2point1.x));
        y = line2point1.x + (b * (line2point2.y - line2point1.y));
*/
    // if line1 is a segment and line2 is infinite, they intersect if:
    if (a > 0 && a < 1) {
        result.onLine1 = true;
    }
    // if line2 is a segment and line1 is infinite, they intersect if:
    if (b > 0 && b < 1) {
        result.onLine2 = true;
    }
    // if line1 and line2 are segments, they intersect if both of the above are true
    return result;
}

function makeVerticalLine(x_coord, maxy) {
    return {p1: {x: x_coord, y: 0}, 
            p2: {x: x_coord, y: maxy}};
}

function makeHorizontalLine(maxx, y_coord) {
    return {p1: {x: 0, y: y_coord}, 
            p2: {x: maxx, y: y_coord}};
}

function generateRandomPoint(limx, limy) {
    return {x: randomInt(0, limx), y: randomInt(0, limy)};
}

function getDistance(point1, point2) {
    return Math.sqrt( Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y) );
}

function makeMondrian(numPartitions, maxWidth, maxHeight) {
    var container = d3.select(".mondrian").append("svg").attr("width", maxWidth).attr("height", maxHeight);
    var drawnLines = [];
    var line;

    // make the partitions
    for (var i = 0; i < numPartitions; i ++ ) {
        if (randomInt(0, 9) >= 5) {
            line = makeVerticalLine(randomInt(0, maxWidth), maxHeight);
        } else {
            line = makeHorizontalLine(maxWidth, randomInt(0, maxHeight));        
        }
        for (var i = 0; i < drawnLines.length; i++) {
            var previous_line = drawnLines[i];
            var result = checkLineIntersection(previous_line, line);
            // does it intersect?
            if (result.onLine1 && result.onLine2) {
                // randomly pick an endpoint
                if (Math.random() > 0.5) {
                    line.p1 = {x: result.x, y: result.y};
                } else {
                    line.p2 = {x: result.x, y: result.y};
                }
            }
        }
        makeLine(container, line.p1, line.p2, 4, "black");
        drawnLines.push(line);
    }
}

function makeLine(lineContainer, point1, point2, width, color) {
    lineContainer.append("line").attr("x1", point1.x).attr("y1", point1.y).attr("x2", point2.x).attr("y2", point2.y)
                                .attr("stroke-width", width).attr("stroke", color);
    return lineContainer;
}

</script>
<body>
    <div class='mondrian'>
    </div>
</body>
<script>
makeMondrian(randomInt(4, 8), maxWidth, maxHeight);

</script>